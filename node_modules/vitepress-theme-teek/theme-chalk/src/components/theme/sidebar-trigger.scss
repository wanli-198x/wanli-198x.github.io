@use "../../mixins/bem" as *;
@use "../../mixins/config" as *;
@use "../../mixins/function" as *;
@use "../../mixins/mixins" as *;

:root {
  @include set-css-var("sidebar-trigger-top-offset", 10px);
  @include set-css-var("sidebar-trigger-left-offset", 10px);
  @include set-css-var("sidebar-trigger-collapse-doc-offset", 160px);
}

@include b(layout) {
  @include has(sidebar-trigger) {
    .VPSidebar {
      transition:
        width getCssVar("transition-duration-slow") ease-in-out,
        padding-left getCssVar("transition-duration-slow") ease-in-out,
        padding-right getCssVar("transition-duration-slow") ease-in-out,
        opacity getCssVar("transition-duration-slow"),
        transform getCssVar("transition-duration");
    }

    .VPContent.has-sidebar.sidebar-trigger-transition {
      transition: padding-left getCssVar("transition-duration-slow") ease-in-out;
    }

    // 没有侧边栏时，隐藏侧边栏触发器
    .VPDoc:not(.has-sidebar) {
      @include b(sidebar-trigger) {
        display: none;
      }
    }

    // 侧边栏折叠时样式
    @include is(sidebar-collapse) {
      @include set-css-var("sidebar-trigger-doc-offset", var(--#{$namespace}-sidebar-trigger-collapse-doc-offset));

      .VPSidebar {
        width: 0 !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
      }

      .VPNav {
        border: 1px solid var(--vp-c-divider);
        .VPNavBar.has-sidebar {
          background-color: var(--vp-nav-bg-color);

          .divider {
            display: none;
          }
        }
      }

      .VPNavBarTitle.has-sidebar {
        > .title {
          border: none;
        }
      }

      // 折叠时，文档内容往左移动
      .VPContent.has-sidebar {
        padding-left: calc(
          (100vw - var(--vp-layout-max-width)) / 2 +
            var(--vp-sidebar-width) - var(#{getCssVarName("sidebar-trigger-doc-offset")}, 0px)
        );
      }

      // 折叠侧边栏的左侧距离
      @include b(sidebar-trigger) {
        left: getCssVar("sidebar-trigger-left-offset") !important;
      }
    }

    // 侧边栏折叠/展开触发器样式
    @include b(sidebar-trigger) {
      position: fixed;
      top: calc(var(--vp-nav-height) + getCssVar("sidebar-trigger-top-offset"));
      left: calc(
        (100% - (var(--vp-layout-max-width) - 64px)) / 2 + var(--vp-sidebar-width) - 32px +
          getCssVar("sidebar-trigger-left-offset")
      );
      transition: left getCssVar("transition-duration-slow") ease-in-out;
      z-index: 20px;

      > div {
        box-shadow: none;
      }

      @include is(active) {
        transition-duration: getCssVar("transition-duration-slow");
      }

      @media (max-width: 1440px) {
        left: calc(var(--vp-sidebar-width) + getCssVar("sidebar-trigger-left-offset")) !important;
      }
      @media (max-width: 1280px) {
        top: calc(var(--vp-nav-height) + getCssVar("sidebar-trigger-top-offset") + 47px);
      }
    }
  }
}

// 适配 pageStyle 配置项生效的样式
@include multiple-b(((card, card-nav, segment, segment-nav))) {
  &.Layout.has-sidebar-trigger {
    @include b(sidebar-trigger) {
      left: calc(var(--vp-sidebar-width) + getCssVar("sidebar-trigger-left-offset"));
    }
    &.is-sidebar-collapse {
      @include b(sidebar-trigger) {
        left: getCssVar("sidebar-trigger-left-offset");
      }
    }
  }
}

// 适配 4 大主题增强的布局切换生效的样式
html[layout-mode="original"] {
  @include b(layout) {
    @include b(sidebar-trigger) {
      left: calc(
        (100% - (var(--vp-layout-max-width) - 64px)) / 2 + var(--vp-sidebar-width) - 32px +
          getCssVar("sidebar-trigger-left-offset")
      );
      transition-duration: getCssVar("transition-duration-slow");
    }
  }
}

html[layout-mode="bothWidthAdjustable"] {
  @include b(layout) {
    @include b(sidebar-trigger) {
      left: calc(
        (100% - (getCssVar("page-max-width") - 64px)) / 2 + var(--vp-sidebar-width) - 32px +
          getCssVar("sidebar-trigger-left-offset")
      );
      transition-duration: getCssVar("transition-duration-slow");
    }
  }
}

html[layout-mode="sidebarWidthAdjustableOnly"] {
  @include b(layout) {
    @include b(sidebar-trigger) {
      left: calc(
        (100% - (getCssVar("page-max-width") - 64px)) / 2 + var(--vp-sidebar-width) - 32px +
          getCssVar("sidebar-trigger-left-offset")
      );
      transition-duration: getCssVar("transition-duration-slow");
    }
  }
}

html[layout-mode="fullWidth"] {
  @include b(layout) {
    @include b(sidebar-trigger) {
      left: calc(
        (100% - (getCssVar("full-width-max-width") - 64px)) / 2 + var(--vp-sidebar-width) - 32px +
          getCssVar("sidebar-trigger-left-offset")
      );
      transition-duration: getCssVar("transition-duration-slow");
    }
  }
}
