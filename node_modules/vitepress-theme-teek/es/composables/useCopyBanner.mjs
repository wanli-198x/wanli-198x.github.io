import { isClient } from '../helper/dist/index.mjs';
import { useEventListener } from './useEventListener.mjs';
import { useNamespace } from './useNamespace.mjs';
import 'vitepress-theme-teek/theme-chalk/tk-copy-banner.css';

const useCopyBanner = (text = "\u590D\u5236\u6210\u529F\uFF0C\u590D\u5236\u548C\u8F6C\u8F7D\u8BF7\u6807\u6CE8\u672C\u6587\u5730\u5740", timeout = 3e3) => {
  if (!isClient) return;
  const ns = useNamespace("copy-banner");
  const listenerCopy = () => {
    if (!window.getSelection()?.toString().trim()) return;
    hideAllCopyBanner();
    const slideClass = ns.e("slide");
    const banner = document.createElement("div");
    const slide = document.createElement("div");
    banner.className = ns.b();
    banner.innerHTML = `
      <div class="${ns.e("content")}">
        <p class="${ns.e("desc")}">${text}</p>
      </div>
    `;
    slide.className = slideClass;
    banner.appendChild(slide);
    document.body.appendChild(banner);
    setTimeout(() => {
      banner.classList.add("is-show");
      slide.style.width = "100%";
    }, 10);
    setTimeout(() => {
      banner.classList.add("is-hide");
    }, timeout);
  };
  const hideAllCopyBanner = () => {
    const banner = document.querySelector(`.${ns.b()}`);
    if (!banner) return;
    banner.remove();
  };
  useEventListener(document, "copy", listenerCopy, { passive: true });
};

export { useCopyBanner };
