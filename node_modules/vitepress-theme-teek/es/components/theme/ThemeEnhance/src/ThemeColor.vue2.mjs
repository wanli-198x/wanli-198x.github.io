import { defineComponent, ref, watch, createBlock, openBlock, unref, normalizeClass, withCtx, createElementBlock, Fragment, renderList, createElementVNode, toDisplayString, normalizeStyle, createTextVNode, createVNode, isRef } from 'vue';
import { useData } from 'vitepress';
import { isClient } from '../../../../helper/dist/index.mjs';
import 'vitepress-theme-teek/theme-chalk/tk-copy-banner.css';
import { useLocale } from '../../../../composables/useLocale.mjs';
import { useMediaQuery } from '../../../../composables/useMediaQuery.mjs';
import { useStorage } from '../../../../composables/useStorage.mjs';
import { useThemeColor, varNameList } from '../../../../composables/useThemeColor.mjs';
import '../../../../composables/useZIndex.mjs';
import waterIcon from '../../../../static/icons/theme-enhance/water.mjs';
import { useTeekConfig } from '../../ConfigProvider/index.mjs';
import { ThemeColorName, mobileMaxWidthMedia, themeColorAttribute, themeColorList } from './themeEnhance.mjs';
import { themeColorStorageKey, themeBgColorStorageKey, ns } from './namespace.mjs';
import _sfc_main$1 from './components/BaseTemplate.vue2.mjs';
import _sfc_main$2 from './components/Switch.vue2.mjs';
import { useThemeColorList } from './useThemeColorList.mjs';

const _hoisted_1 = { class: "flx-justify-between flx-1" };
const _hoisted_2 = { class: "flx-align-center" };
const _hoisted_3 = { class: "label" };
const _hoisted_4 = ["title", "aria-label"];
const _hoisted_5 = { class: "color-list flx-justify-between flx-wrap" };
const _hoisted_6 = ["onClick", "title", "aria-label"];
var _sfc_main = /* @__PURE__ */ defineComponent({
  ...{ name: "ThemeColor" },
  __name: "ThemeColor",
  setup(__props) {
    const { getTeekConfigRef } = useTeekConfig();
    const themeEnhanceConfig = getTeekConfigRef("themeEnhance", {});
    const { t } = useLocale();
    const { frontmatter } = useData();
    const isMobile = useMediaQuery(mobileMaxWidthMedia);
    const themeColorName = useStorage(
      themeColorStorageKey,
      themeEnhanceConfig.value.themeColor?.defaultColorName || ThemeColorName.vpDefault
    );
    const isSpread = useStorage(themeBgColorStorageKey, themeEnhanceConfig.value.themeColor?.defaultSpread || false);
    const oldThemeColor = ref(themeColorName.value);
    const primaryColor = ref("");
    const { clear, updateSpread } = useThemeColor(primaryColor, () => {
      if (themeColorList.includes(themeColorName.value)) {
        return [varNameList.vpBrand1, varNameList.vpBrand2, varNameList.vpBrand3, varNameList.vpBrandSoft];
      }
    });
    const themeColorSelectList = useThemeColorList();
    const update = (val) => {
      if (!isClient) return;
      const el = document.documentElement;
      if (el.getAttribute(themeColorAttribute) === val) return;
      el.setAttribute(themeColorAttribute, val);
      if (themeColorList.includes(val)) {
        clear();
        primaryColor.value = getComputedStyle(el).getPropertyValue(varNameList.vpBrand1);
      } else {
        const appendThemeColor = themeEnhanceConfig.value.themeColor?.append || [];
        const option = appendThemeColor.map((item) => item.options).flat().filter((item) => item.value === val);
        const color = option[0]?.color;
        !color && clear();
        primaryColor.value = color || getComputedStyle(el).getPropertyValue(varNameList.vpBrand1);
      }
      themeEnhanceConfig.value.themeColor?.switchColorDone?.(val);
    };
    watch(themeColorName, update, { immediate: true });
    watch(
      () => frontmatter.value.themeColorName,
      (newVal) => {
        if (newVal) {
          oldThemeColor.value = themeColorName.value;
          themeColorName.value = newVal;
        } else {
          themeColorName.value = oldThemeColor.value;
        }
      },
      { immediate: true }
    );
    watch(isSpread, updateSpread, { immediate: true, flush: "post" });
    const tips = [
      { title: t("tk.themeEnhance.themeColor.vpHelpTipTitle"), content: t("tk.themeEnhance.themeColor.vpHelpTipContent") },
      { title: t("tk.themeEnhance.themeColor.epHelpTipTitle"), content: t("tk.themeEnhance.themeColor.epHelpTipContent") }
    ];
    const handleChangePrimaryColor = (option) => {
      themeColorName.value = option.value;
    };
    const getStyle = (color) => {
      return color ? { backgroundColor: color } : {};
    };
    return (_ctx, _cache) => {
      return openBlock(), createBlock(_sfc_main$1, {
        class: normalizeClass(unref(ns).e("theme-color")),
        icon: unref(waterIcon),
        title: unref(t)("tk.themeEnhance.themeColor.title"),
        helper: !unref(themeEnhanceConfig).themeColor?.disableHelp,
        "helper-desc": unref(t)("tk.themeEnhance.themeColor.helpDesc"),
        tips,
        disabled: unref(isMobile)
      }, {
        title: withCtx(() => [
          createElementVNode("div", _hoisted_1, [
            createTextVNode(
              toDisplayString(unref(t)("tk.themeEnhance.themeColor.title")) + " ",
              1
              /* TEXT */
            ),
            createElementVNode("div", _hoisted_2, [
              createElementVNode(
                "span",
                _hoisted_3,
                toDisplayString(unref(t)("tk.themeEnhance.themeColor.speedLabel")),
                1
                /* TEXT */
              ),
              createVNode(_sfc_main$2, {
                modelValue: unref(isSpread),
                "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => isRef(isSpread) ? isSpread.value = $event : null)
              }, null, 8, ["modelValue"])
            ])
          ])
        ]),
        default: withCtx(() => [
          (openBlock(true), createElementBlock(
            Fragment,
            null,
            renderList(unref(themeColorSelectList), (item) => {
              return openBlock(), createElementBlock(
                Fragment,
                {
                  key: item.label
                },
                [
                  createElementVNode("h3", {
                    title: item.tip,
                    "aria-label": item.label
                  }, toDisplayString(item.label), 9, _hoisted_4),
                  createElementVNode("ul", _hoisted_5, [
                    (openBlock(true), createElementBlock(
                      Fragment,
                      null,
                      renderList(item.options, (option) => {
                        return openBlock(), createElementBlock("li", {
                          key: item.label + option.value,
                          class: "flx-column-center",
                          onClick: ($event) => handleChangePrimaryColor(option),
                          title: option.title,
                          "aria-label": option.ariaLabel ?? option.title ?? option.label
                        }, [
                          createElementVNode(
                            "div",
                            {
                              class: normalizeClass(["color-wrapper flx-center", unref(ns).is("active", option.value === unref(themeColorName))])
                            },
                            [
                              createElementVNode(
                                "div",
                                {
                                  class: "color-bg",
                                  style: normalizeStyle(getStyle(option.color))
                                },
                                null,
                                4
                                /* STYLE */
                              )
                            ],
                            2
                            /* CLASS */
                          ),
                          createElementVNode(
                            "span",
                            null,
                            toDisplayString(option.label),
                            1
                            /* TEXT */
                          )
                        ], 8, _hoisted_6);
                      }),
                      128
                      /* KEYED_FRAGMENT */
                    ))
                  ])
                ],
                64
                /* STABLE_FRAGMENT */
              );
            }),
            128
            /* KEYED_FRAGMENT */
          ))
        ]),
        _: 1
        /* STABLE */
      }, 8, ["class", "icon", "title", "helper", "helper-desc", "disabled"]);
    };
  }
});

export { _sfc_main as default };
