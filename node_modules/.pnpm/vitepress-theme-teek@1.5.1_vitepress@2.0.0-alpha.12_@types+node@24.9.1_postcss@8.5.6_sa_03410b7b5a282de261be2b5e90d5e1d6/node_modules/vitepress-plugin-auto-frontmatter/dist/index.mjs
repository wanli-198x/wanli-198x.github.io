import{createLogger as $,normalizePath as D}from"vite";import{join as k,basename as I,resolve as S,relative as P}from"node:path";import{glob as T}from"tinyglobby";import b from"gray-matter";import{readFileSync as z,statSync as A,writeFileSync as E}from"node:fs";import d from"picocolors";const H=(e,r="yyyy-MM-dd hh:mm:ss")=>{if(!e)return"";const t=new Date(e),n=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),l=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),p=String(t.getSeconds()).padStart(2,"0");return r.replace("yyyy",n.toString()).replace("MM",o).replace("dd",s).replace("hh",l).replace("mm",i).replace("ss",p)},L="1.0.13",m=$("info",{prefix:`[vitepress-plugin-auto-frontmatter v${L}]`}),R=(e,r="green",t={timestamp:!0})=>{m.info(d[r](e),t)},W=(e,r="yellow",t={timestamp:!0})=>{m.warn(d[r](e),t)},Y=(e,r="yellow",t={timestamp:!0})=>{m.info(d[r](e),t)},_=(e,r="red",t={timestamp:!0})=>{m.error(d[r](e),t)},q={info:R,warn:W,warnOnce:Y,error:_};function B(e={}){let r=!1;return{name:"vitepress-plugin-auto-frontmatter",async config(t){if(r)return;r=!0;let{pattern:n}=e;if(!n)return;const{globOptions:o}=e,{srcDir:s}=t.vitepress;typeof n=="string"&&(n=[n]),n=n.map(i=>D(k(s,i)));const l=await T(n,{expandDirectories:!1,...o,absolute:!0,ignore:["**/node_modules/**","**/dist/**",...o?.ignore||[]]});C(l,e,s)}}}const C=(e,r,t)=>{const{include:n,exclude:o,transform:s,recoverTransform:l=!1}=r;for(const i of e){if(!i.endsWith(".md"))continue;const p=z(i,"utf-8"),{data:c,content:O}=b(p);if(c.layout==="home"||c.layout===!1||!v(c,{exclude:o,include:n}))continue;let a={...c},g=!1;const y=A(i),w={title:x(I(i)),date:y.birthtime||y.atime};for(const[u,j]of Object.entries(w))c[u]===void 0&&(a={[u]:j,...a},g=!0);const h=s?.(a,M(t,i));if(!g&&!h)continue;const f=h||a;if(f.date=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(a.date)?a.date:H(a.date,"yyyy-MM-dd hh:mm:ss"),!l&&Object.keys(f).every(u=>c[u]!==void 0))continue;const F=Object.keys(f).length?b.stringify("",f).replace(/'/g,"").replace(/(?:\r?\n)$/,""):"";E(i,`${F}${O}`),q.info(`'${i}' has been successfully written to frontmatter. (\u6210\u529F\u5199\u5165 frontmatter)`)}},v=(e,{exclude:r,include:t})=>{if(t&&!Object.keys(e).length)return!1;if(r||t){for(const[n,o]of Object.entries(e))if(r?.[n]===o||t?.[n]!==o)return!1}return!0},x=e=>{let r="";const t=e.split(".");if(t.length===2)r=t[0];else{const n=e.indexOf("."),o=e.lastIndexOf(".");r=e.substring(n+1,o)}return r},M=(e,r)=>{const t=S(e),n=S(r),o=P(t,n).replace(/\\/g,"/");return{filePath:r,relativePath:o}};export{v as checkExcludeAndInclude,B as default,M as getFileInfo,x as getMdFileTitle};
