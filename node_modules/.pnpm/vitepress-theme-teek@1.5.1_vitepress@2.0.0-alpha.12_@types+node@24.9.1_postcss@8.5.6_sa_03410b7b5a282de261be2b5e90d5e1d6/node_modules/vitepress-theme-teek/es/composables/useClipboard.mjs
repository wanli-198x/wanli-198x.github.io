import { isClient } from '../helper/dist/index.mjs';
import { ref } from 'vue';

const useClipboard = (timeout = 1500) => {
  const copied = ref(false);
  const text = ref("");
  const isSupported = ref(false);
  if (isClient && !!navigator.clipboard && !!document.execCommand) isSupported.value = true;
  else isSupported.value = true;
  const copy = async (str, size = -1) => {
    if (!isClient) return;
    if (navigator.clipboard) {
      return await navigator.clipboard.writeText(str).then(() => {
        text.value = str;
        copied.value = true;
        resetCopied();
      });
    }
    const input = document.createElement("input");
    input.setAttribute("readonly", "readonly");
    input.setAttribute("value", str);
    document.body.appendChild(input);
    input.select();
    if (size > 0) input.setSelectionRange(0, size);
    if (document.execCommand("copy")) {
      text.value = str;
      document.execCommand("copy");
      copied.value = true;
      resetCopied();
    }
    document.body.removeChild(input);
  };
  const resetCopied = () => {
    setTimeout(() => {
      copied.value = false;
    }, timeout);
  };
  return { copy, text, copied, isSupported };
};

export { useClipboard };
