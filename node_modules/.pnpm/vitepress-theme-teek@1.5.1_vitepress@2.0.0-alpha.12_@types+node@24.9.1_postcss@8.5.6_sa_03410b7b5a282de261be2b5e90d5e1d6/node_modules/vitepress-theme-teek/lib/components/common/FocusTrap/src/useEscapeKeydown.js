'use strict';

var Vue = require('vue');
var index = require('../../../../helper/dist/index.js');

let registeredEscapeHandlers = [];
const cachedHandler = (event) => {
  if (event.code === "Escape") {
    registeredEscapeHandlers.forEach((registeredHandler) => registeredHandler(event));
  }
};
const useEscapeKeydown = (handler) => {
  Vue.onMounted(() => {
    if (registeredEscapeHandlers.length === 0) document.addEventListener("keydown", cachedHandler);
    if (index.isClient) registeredEscapeHandlers.push(handler);
  });
  Vue.onBeforeUnmount(() => {
    registeredEscapeHandlers = registeredEscapeHandlers.filter((registeredHandler) => registeredHandler !== handler);
    if (registeredEscapeHandlers.length === 0) {
      if (index.isClient) document.removeEventListener("keydown", cachedHandler);
    }
  });
};

exports.useEscapeKeydown = useEscapeKeydown;
