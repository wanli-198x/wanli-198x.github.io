import{readFileSync as P}from"node:fs";import{createLogger as S,normalizePath as $}from"vite";import U from"gray-matter";import{glob as j}from"tinyglobby";import{createMarkdownRenderer as T}from"vitepress";import{join as W,relative as z}from"node:path";import s from"picocolors";const G="1.0.13",i=S("info",{prefix:`[vitepress-plugin-file-content-loader v${G}]`}),K=(e,r="green",t={timestamp:!0})=>{i.info(s[r](e),t)},M=(e,r="yellow",t={timestamp:!0})=>{i.warn(s[r](e),t)},N=(e,r="yellow",t={timestamp:!0})=>{i.info(s[r](e),t)},V=(e,r="red",t={timestamp:!0})=>{i.error(s[r](e),t)},q={info:K,warn:M,warnOnce:N,error:V},B=["**/node_modules/**","**/dist/**"];function H(e){let r=!1;return{name:"vite-plugin-vitepress-file-content-loader",async config(t){if(r)return;r=!0;let{pattern:o}=e;if(!o)return;const{includeSrc:D=!1,render:_=!1,excerpt:a,transformData:d,transformRaw:u,globOptions:g,themeConfigKey:m="contentLoader"}=e,{site:{themeConfig:E={},base:R},srcDir:c,cleanUrls:w,markdown:C,rewrites:F}=t.vitepress;typeof o=="string"&&(o=[o]),o=o.map(n=>$(W(c,n)));const L=(await j(o,{expandDirectories:!1,...g,ignore:["**/node_modules/**","**/dist/**",...g?.ignore||[]]})).sort(),h=await T(c,C,R,i),l=[];for(const n of L){if(!n.endsWith(".md"))continue;const p=P(n,"utf-8"),{data:O,excerpt:x}=U(p,typeof a=="string"?{excerpt_separator:a}:{excerpt:a}),f=$(z(c,n)).replace(/(^|\/)index\.md$/,"$1"),b="/"+f.replace(/\.md$/,w?"":".html"),k="/"+(F.map[f]||f).replace(/\.md$/,w?"":".html"),A=_?h.render(p):void 0,I=a&&x?.endsWith(`
`)?h.render(x):void 0,y={src:D?p:void 0,html:A,frontmatter:O,excerpt:I,relativePath:b,url:k};l.push(d?await d(y):y)}E[m]=u?await u(l):l;const v=m.charAt(0).toUpperCase()+m.slice(1);q.info(`Injected ${v} Data Successfully. \u6CE8\u5165 ${v} \u6570\u636E\u6210\u529F!`)}}}export{B as DEFAULT_IGNORE_DIR,H as default};
