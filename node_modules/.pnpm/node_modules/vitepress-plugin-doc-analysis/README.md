# vitepress-plugin-doc-analysis

è¿™æ˜¯ä¸€ä¸ªé€‚ç”¨äº `vitepress` çš„ Vite æ’ä»¶ï¼Œåœ¨ `vitepress` å¯åŠ¨ååˆ†æ Markdown æ–‡æ¡£ã€‚

## âœ¨ Feature

- ğŸš€ è‡ªåŠ¨åˆ†æ Markdown æ–‡æ¡£ä¿¡æ¯ï¼ŒæŒ‚è½½åˆ° `themeConfig.docAnalysisInfo`
- ğŸš€ æ”¯æŒ locales å›½é™…åŒ–çš„æ–‡æ¡£åˆ†æï¼ŒæŒ‚è½½åˆ° `locales.[lang].themeConfig.docAnalysisInfo`

## ğŸ•¯ï¸ Install

å®‰è£… `vitepress-plugin-doc-analysis` æ’ä»¶

```bash
# æ¨èä½¿ç”¨ pnpm
pnpm i vitepress-plugin-doc-analysis
# or yarn
yarn add vitepress-plugin-doc-analysis
# or npm
npm install vitepress-plugin-doc-analysis
```

æ·»åŠ  `vitepress-plugin-doc-analysis` æ’ä»¶åˆ° `.vitepress/config.ts`

```typescript
import { defineConfig } from "vitepress";
import DocAnalysis from "vitepress-plugin-doc-analysis";

export default defineConfig({
  vite: {
    plugins: [DocAnalysis(/* options */)],
  },
});
```

> è¯´æ˜ï¼šè¯¥æ’ä»¶ä»…é™é¡¹ç›®å¯åŠ¨æ—¶ç”Ÿæ•ˆï¼Œå·²æ”¹åŠ¨æˆ–æ–°æ·»åŠ çš„ Markdown éœ€è¦é‡å¯é¡¹ç›®æ‰èƒ½ç”Ÿæ•ˆã€‚

æ’ä»¶é»˜è®¤å¿½ç•¥ `["node_modules", "dist", ".vitepress", "public"]` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸”åªæ‰«æ Markdown æ–‡æ¡£ã€‚

## ğŸ“– Usage

è·å–æ’ä»¶åˆ†æåçš„æ•°æ®ï¼š

```vue
<script setup lang="ts">
import { useData } from "vitepress";
import type { DocAnalysis } from "vitepress-plugin-doc-analysis";

const { theme } = useData();
const { fileList, totalFileWords, eachFileWords, lastCommitTime }: DocAnalysis = theme.value;

// å¦‚æœå¤„åœ¨å›½é™…åŒ–ç¯å¢ƒä¸‹ï¼Œvitepress ä¼šå°†å½“å‰è¯­è¨€çš„ themeConfig æ”¾åˆ° theme é‡Œï¼Œä¸åŸå…ˆçš„ theme è¿›è¡Œåˆå¹¶
</script>

<template></template>
```

å¦‚æœä¸å¸Œæœ›æŸä¸ª Markdown æ–‡æ¡£è¢«æ’ä»¶åˆ†æï¼Œè¯·åœ¨è¯¥æ–‡æ¡£ `frontmatter` é…ç½®ï¼š

```yaml
---
docAnalysis: false
---
```

## ğŸ“š Example

### transformFile

é€šè¿‡ `transformFile` é…ç½®é¡¹ï¼Œå¯ä»¥è‡ªå®šä¹‰è¿”å›çš„æ–‡ä»¶ä¿¡æ¯ã€‚

```typescript
import type {} from "vitepress-plugin-doc-analysis";
import DocAnalysis from "vitepress-plugin-doc-analysis";
import { defineConfig } from "vitepress";
import { statSync } from "node:fs";

const docAnalysisOption = {
  transformFile: (fileInfo: FilePathInfo) => {
    // è·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´
    const mtime = statSync(fileInfo.relativePath).mtime.toLocaleString();
    return { mtime };
  },
};

export default defineConfig({
  vite: {
    plugins: [DocAnalysis(docAnalysisOption)],
  },
});
```

éªŒè¯ï¼š

```vue
<script setup lang="ts">
import { useData } from "vitepress";
import type { DocAnalysis } from "vitepress-plugin-doc-analysis";

const { theme } = useData();
const { fileList }: DocAnalysis = theme.value;

// æ­¤æ—¶å¤šå‡ºäº† mtime
console.log(fileList);
</script>

<template></template>
```

## ğŸ› ï¸ Options

| name          | description                                            | type       | default                        |
| ------------- | ------------------------------------------------------ | ---------- | ------------------------------ |
| ignoreList    | å¿½ç•¥çš„æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼                  | `string[]` | `[]`                           |
| path          | æŒ‡å®šæ‰«æçš„æ ¹ç›®å½•                                       | `string`   | `vitepress` çš„ `srcDir` é…ç½®é¡¹ |
| ignoreIndexMd | æ˜¯å¦å¿½ç•¥æ¯ä¸ªç›®å½•ä¸‹çš„ `index.md` æ–‡ä»¶                   | `boolean`  | `false`                        |
| cn            | 1 åˆ†é’Ÿå†…é˜…è¯»çš„ä¸­æ–‡å­—æ•°ï¼Œé˜…è¯»æ—¶é—´è®¡ç®—éœ€è¦               | `number`   | 300                            |
| en            | 1 åˆ†é’Ÿå†…é˜…è¯»çš„è‹±æ–‡å­—æ•°ï¼Œé˜…è¯»æ—¶é—´è®¡ç®—éœ€è¦               | `number`   | 160                            |
| transformFile | è‡ªå®šä¹‰å‡½æ•°æ¥è¿”å›é¢å¤–çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæœ€ç»ˆå­˜æ”¾åˆ° fileInfo é‡Œ | `Function` | -                              |

## ğŸ“˜ TypeScript

### ğŸ› ï¸ Options

```typescript
export interface DocAnalysisOption {
  /**
   * å¿½ç•¥çš„æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
   *
   * @default []
   */
  ignoreList?: Array<RegExp | string>;
  /**
   * æ–‡ç« æ‰€åœ¨çš„ç›®å½•ï¼ŒåŸºäº .vitepress ç›®å½•å±‚çº§æ·»åŠ ï¼Œå¼€å¤´ä¸éœ€è¦æœ‰ /
   *
   * @default 'vitepress çš„ srcDir é…ç½®é¡¹'
   */
  path?: string;
  /**
   * æ˜¯å¦å¿½ç•¥æ¯ä¸ªç›®å½•ä¸‹çš„ index.md æ–‡ä»¶
   *
   * @default false
   */
  ignoreIndexMd?: boolean;
  /**
   * 1 åˆ†é’Ÿå†…é˜…è¯»çš„ä¸­æ–‡å­—æ•°
   *
   * @default 300
   */
  cn?: number;
  /**
   * 1 åˆ†é’Ÿå†…é˜…è¯»çš„è‹±æ–‡å­—æ•°
   *
   * @default 160
   */
  en?: number;
  /**
   * è‡ªå®šä¹‰å‡½æ•°æ¥è¿”å›é¢å¤–çš„æ–‡ä»¶ä¿¡æ¯ï¼Œæœ€ç»ˆå­˜æ”¾åˆ° fileInfo é‡Œ
   *
   * @param filePath æ–‡ä»¶è·¯å¾„ä¿¡æ¯
   */
  transformFile?: (filePath: FilePathInfo) => Record<string, any> | undefined;
}
```

### ğŸ“– Usage

```typescript
export interface DocAnalysis {
  /**
   * æ–‡ä»¶è·¯å¾„åˆ—è¡¨
   */
  fileList: FilePathInfo[];
  /**
   * æ–‡ä»¶æ€»å…±å­—æ•°
   */
  totalFileWords: string;
  /**
   * æ–‡ä»¶ä¿¡æ¯åˆ—è¡¨
   */
  eachFileWords: FileInfo[];
  /**
   * git ä¸Šæ¬¡ commit æ—¶é—´
   */
  lastCommitTime: string;
}

export interface FileInfo {
  /**
   * æ–‡ä»¶è·¯å¾„
   */
  fileInfo: FilePathInfo;
  /**
   * å­—æ•°
   */
  wordCount: number;
  /**
   * é˜…è¯»æ—¶é—´
   */
  readingTime: string;
  /**
   * æ–‡ä»¶ frontmatter æ•°æ®
   */
  frontmatter: Record<string, any>;
}

export interface FilePathInfo {
  /**
   * æ–‡ä»¶ç»å¯¹è·¯å¾„
   */
  filePath: string;
  /**
   * æ–‡ä»¶ç›¸å¯¹è·¯å¾„
   */
  relativePath: string;
  /**
   * é€šè¿‡ transformFile é…ç½®é¡¹å¾—åˆ°çš„å…¶ä»–ä¿¡æ¯
   */
  [key: string]: any;
}
```

## ğŸ‰‘ License

[MIT](../../LICENSE) License Â© 2025 [Teeker](https://github.com/Kele-Bingtang)
