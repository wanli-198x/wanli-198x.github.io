"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const vite=require("vite"),node_path=require("node:path"),tinyglobby=require("tinyglobby"),y=require("gray-matter"),node_fs=require("node:fs"),e=require("picocolors");function _interopDefaultCompat(t){return t&&typeof t=="object"&&"default"in t?t.default:t}const y__default=_interopDefaultCompat(y),e__default=_interopDefaultCompat(e),formatDate=(t,n="yyyy-MM-dd hh:mm:ss")=>{if(!t)return"";const r=new Date(t),o=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0"),u=String(r.getHours()).padStart(2,"0"),i=String(r.getMinutes()).padStart(2,"0"),p=String(r.getSeconds()).padStart(2,"0");return n.replace("yyyy",o.toString()).replace("MM",s).replace("dd",c).replace("hh",u).replace("mm",i).replace("ss",p)},version="1.0.13",logger=vite.createLogger("info",{prefix:`[vitepress-plugin-auto-frontmatter v${version}]`}),info=(t,n="green",r={timestamp:!0})=>{logger.info(e__default[n](t),r)},warn=(t,n="yellow",r={timestamp:!0})=>{logger.warn(e__default[n](t),r)},warnOnce=(t,n="yellow",r={timestamp:!0})=>{logger.info(e__default[n](t),r)},error=(t,n="red",r={timestamp:!0})=>{logger.error(e__default[n](t),r)},S={info,warn,warnOnce,error};function M(t={}){let n=!1;return{name:"vitepress-plugin-auto-frontmatter",async config(r){if(n)return;n=!0;let{pattern:o}=t;if(!o)return;const{globOptions:s}=t,{srcDir:c}=r.vitepress;typeof o=="string"&&(o=[o]),o=o.map(i=>vite.normalizePath(node_path.join(c,i)));const u=await tinyglobby.glob(o,{expandDirectories:!1,...s,absolute:!0,ignore:["**/node_modules/**","**/dist/**",...s?.ignore||[]]});R(u,t,c)}}}const R=(t,n,r)=>{const{include:o,exclude:s,transform:c,recoverTransform:u=!1}=n;for(const i of t){if(!i.endsWith(".md"))continue;const p=node_fs.readFileSync(i,"utf-8"),{data:l,content:b}=y__default(p);if(l.layout==="home"||l.layout===!1||!checkExcludeAndInclude(l,{exclude:s,include:o}))continue;let a={...l},g=!1;const m=node_fs.statSync(i),v={title:getMdFileTitle(node_path.basename(i)),date:m.birthtime||m.atime};for(const[f,O]of Object.entries(v))l[f]===void 0&&(a={[f]:O,...a},g=!0);const h=c?.(a,getFileInfo(r,i));if(!g&&!h)continue;const d=h||a;if(d.date=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(a.date)?a.date:formatDate(a.date,"yyyy-MM-dd hh:mm:ss"),!u&&Object.keys(d).every(f=>l[f]!==void 0))continue;const x=Object.keys(d).length?y__default.stringify("",d).replace(/'/g,"").replace(/(?:\r?\n)$/,""):"";node_fs.writeFileSync(i,`${x}${b}`),S.info(`'${i}' has been successfully written to frontmatter. (\u6210\u529F\u5199\u5165 frontmatter)`)}},checkExcludeAndInclude=(t,{exclude:n,include:r})=>{if(r&&!Object.keys(t).length)return!1;if(n||r){for(const[o,s]of Object.entries(t))if(n?.[o]===s||r?.[o]!==s)return!1}return!0},getMdFileTitle=t=>{let n="";const r=t.split(".");if(r.length===2)n=r[0];else{const o=t.indexOf("."),s=t.lastIndexOf(".");n=t.substring(o+1,s)}return n},getFileInfo=(t,n)=>{const r=node_path.resolve(t),o=node_path.resolve(n),s=node_path.relative(r,o).replace(/\\/g,"/");return{filePath:n,relativePath:s}};exports.checkExcludeAndInclude=checkExcludeAndInclude,exports.default=M,exports.getFileInfo=getFileInfo,exports.getMdFileTitle=getMdFileTitle;
