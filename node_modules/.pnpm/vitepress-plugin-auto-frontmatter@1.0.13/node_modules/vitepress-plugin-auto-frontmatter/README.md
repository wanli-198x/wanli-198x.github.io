# vitepress-plugin-auto-frontmatter

è¿™æ˜¯ä¸€ä¸ªé€‚ç”¨äº `vitepress` çš„ Vite æ’ä»¶ï¼Œ`vitepress` å¯åŠ¨æ—¶ï¼Œæ’ä»¶ä¼šç»™æŒ‡å®šçš„ Markdown è‡ªåŠ¨ç”Ÿæˆ `frontmatter`ã€‚

## âœ¨ Feature

- ğŸš€ è‡ªåŠ¨ç”Ÿæˆ `frontmatter`
- ğŸš€ æ”¯æŒè‡ªå®šä¹‰æ–°çš„ `frontmatter`

## ğŸ•¯ï¸ Install

å®‰è£… `vitepress-plugin-auto-frontmatter` æ’ä»¶

```bash
# æ¨èä½¿ç”¨ pnpm
pnpm i vitepress-plugin-auto-frontmatter
# or yarn
yarn add vitepress-plugin-auto-frontmatter
# or npm
npm install vitepress-plugin-auto-frontmatter
```

æ·»åŠ  `vitepress-plugin-auto-frontmatter` æ’ä»¶åˆ° `.vitepress/config.ts`

```typescript
import { defineConfig } from "vitepress";
import AutoFrontmatter from "vitepress-plugin-auto-frontmatter";

export default defineConfig({
  vite: {
    plugins: [AutoFrontmatter(/* options */)],
  },
});
```

> è¯´æ˜ï¼šè¯¥æ’ä»¶ä»…é™é¡¹ç›®å¯åŠ¨æ—¶ç”Ÿæ•ˆã€‚

æ’ä»¶é»˜è®¤å¿½ç•¥ `frontmatter` ä¸­ `layout: home` å’Œ `["node_modules", "dist"]` ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸”åªæ‰«æ Markdown æ–‡æ¡£ã€‚

æ’ä»¶é»˜è®¤ç»™ Markdown æ–‡ä»¶ç”Ÿæˆ `title` å’Œ `date` ä¸¤ä¸ªå±æ€§ï¼Œå…¶ä¸­ `title` ä¸ºæ–‡ä»¶åï¼ˆæ”¯æŒå¸¦åºå·çš„æ–‡ä»¶åï¼Œå¦‚ `01.xx.md`ï¼‰ï¼Œ`date` ä¸ºæ–‡ä»¶çš„åˆ›å»ºæ—¥æœŸã€‚

```yaml
---
title: æ–‡ä»¶å
date: yyyy-MM-dd hh:mm:ss
---
```

å¦‚æœæƒ³è¦æ‹“å±•æ–°çš„ `frontmatter`ï¼Œå¾€ä¸‹çœ‹ `Example 2` å’Œ `Example 3`ã€‚

## ğŸ“– Usage

å¦‚æœæƒ³æ‹“å±• `frontmatter` çš„å†…å®¹ï¼Œåˆ™ä½¿ç”¨ `transform` å‡½æ•°ã€‚

### Example 1

å‡è®¾ä¸€ä¸ªæ–‡ä»¶åä¸º `guide.md`ï¼Œ`frontmatter` å¦‚ä¸‹ï¼š

```yaml
---
tag: true
---
```

ä½¿ç”¨ `exclude` æ’é™¤è¯¥ `frontmatter` æ¥ç”Ÿæˆæ–°çš„ `frontmatter`ï¼š

```typescript
const excludeFile = () => {
  const plugins: PluginOption[] = [];
  const autoFrontmatterOption = {
    pattern: "**/*.md",
    exclude: { tag: true }, // æ’é™¤ tag: true çš„ MD æ–‡ä»¶ï¼Œæ”¯æŒå¤šä¸ªé…ç½®
  };

  plugins.push(AutoFrontmatter(autoFrontmatterOption));

  return {
    vite: {
      plugins,
    },
  };
};
```

ä½¿ç”¨ `include` åªå¯¹è¯¥ `frontmatter` ç”Ÿæˆæ–°çš„ `frontmatter`ã€‚

```typescript
const excludeFile = () => {
  const plugins: PluginOption[] = [];
  const autoFrontmatterOption = {
    pattern: "**/*.md",
    include: { tag: true }, // æ”¯æŒå¤šä¸ªé…ç½®
  };

  plugins.push(AutoFrontmatter(autoFrontmatterOption));

  return {
    vite: {
      plugins,
    },
  };
};
```

æœ€ç»ˆç”Ÿæˆå¦‚ä¸‹ï¼š

```yaml
---
title: guide
date: 2025-03-04
---
```

### Example 2

é€šè¿‡ `transform` å‡½æ•°æ¥æ·»åŠ ä¸€ä¸ªå”¯ä¸€çš„æ°¸ä¹…é“¾æ¥:

```typescript
const addPermalink = () => {
  const plugins: PluginOption[] = [];
  const autoFrontmatterOption = { pattern: "**/*.md" };

  autoFrontmatterOption.transform = frontmatter => {
    // å¦‚æœæ–‡ä»¶æœ¬èº«å­˜åœ¨äº† permalinkï¼Œåˆ™ä¸ç”Ÿæˆ
    if (frontmatter.permalink) return;

    const transformResult = { ...frontmatter, ...createPermalink() };

    // ç¡®ä¿è¿”å›å€¼å­˜åœ¨ï¼Œå¦‚æœè¿”å› {} å°†ä¼šæ¸…ç©ºæ–‡ä»¶æœ¬èº«çš„ frontmatterï¼Œè¿”å› undefined åˆ™å‘Šè¯‰æ’ä»¶ä¸ä½¿ç”¨ transform è¿”å›çš„æ•°æ®
    return Object.keys(transformResult).length ? transformResult : undefined;
  };

  plugins.push(AutoFrontmatter(autoFrontmatterOption));

  return {
    vite: {
      plugins,
    },
  };
};

/**
 * åˆ›å»º permalink æ°¸ä¹…é“¾æ¥
 */
export const createPermalink = () => {
  return {
    permalink: `/pages/${(Math.random() + Math.random()).toString(16).slice(2, 8)}`,
  };
};
```

æ•ˆæœå¦‚ä¸‹ï¼š

```yaml
---
date: 2025-03-03 00:45:16
title: æ’ä»¶æµ‹è¯•
permalink: /pages/eb8f2f
---
```

### Example 3

é€šè¿‡ `transform` å‡½æ•°æ¥åŸºäºæ–‡ä»¶è·¯å¾„æ·»åŠ ç›®å½•ï¼Œå¦‚ï¼š

```
.
â”œâ”€ docs                # é¡¹ç›®æ ¹ç›®å½•
â”‚  â”œâ”€ guide
â”‚  â”‚  â”œâ”€ vue
â”‚  â”‚  â”‚  â””â”€ getting.md
```

`getting.md` æ–‡ä»¶çš„ `frontmatter` å°†ä¼šç”Ÿæˆï¼š

```yaml
---
categories:
  - guide
  - vue
---
```

éœ€è¦ä½¿ç”¨ `transform` çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š

```typescript
const addCategories = () => {
  const plugins: PluginOption[] = [];
  const autoFrontmatterOption = { pattern: "**/*.md" };

  autoFrontmatterOption.transform = (frontmatter, fileInfo) => {
    // å¦‚æœæ–‡ä»¶æœ¬èº«å­˜åœ¨äº† categoriesï¼Œåˆ™ä¸ç”Ÿæˆ
    if (frontmatter.categories) return;

    const transformResult = { ...frontmatter, ...createCategories(fileInfo) };

    // ç¡®ä¿è¿”å›å€¼å­˜åœ¨ï¼Œå¦‚æœè¿”å› {} å°†ä¼šæ¸…ç©ºæ–‡ä»¶æœ¬èº«çš„ frontmatterï¼Œè¿”å› undefined åˆ™å‘Šè¯‰æ’ä»¶ä¸ä½¿ç”¨ transform è¿”å›çš„æ•°æ®
    return Object.keys(transformResult).length ? transformResult : undefined;
  };

  plugins.push(AutoFrontmatter(autoFrontmatterOption));

  return {
    vite: {
      plugins
    }
  }
}

/**
 * åˆ›å»º categories åˆ†ç±»åˆ—è¡¨
 *
 * @param fileInfo æ–‡ä»¶ä¿¡æ¯
 */
export const createCategory = (fileInfo: FileInfo) => {
  // relativePath ä¸ºåŸºäº vp srcDir çš„ç›¸å¯¹è·¯å¾„ï¼Œé»˜è®¤æ˜¯åŸºäºé¡¹ç›®æ ¹ç›®å½•ï¼Œå¦‚ guide/vue/getting.md
  const relativePathArr = fileInfo.relativePath.split("/");

  const categories: string[] = [];
  relativePathArr.forEach((item, index) => {
    // å¿½ç•¥æ–‡ä»¶å
    if (index !== relativePathArr.length - 1))
      categories.push(filename);
  });

  // [""] è¡¨ç¤ºæ·»åŠ ä¸€ä¸ªä¸ºç©ºçš„ categories
  return { categories: categories.length ? categories : [""] };
};
```

æ•ˆæœå¦‚ä¸‹ï¼š

```yaml
---
date: 2025-03-03 00:45:16
title: getting
categories:
  - guide
  - vue
---
```

> å¦‚æœ `transform` å‡½æ•°è¿”å›çš„ `frontmatter` å·²ç»åœ¨æ–‡ä»¶å­˜åœ¨ï¼ˆåªæ¯”è¾ƒ Key æ˜¯å¦ç›¸åŒï¼Œä¸æ¯”è¾ƒ Valueï¼‰ï¼Œåˆ™å¿½ç•¥ç”Ÿæˆã€‚

## ğŸ› ï¸ Options

| name             | description                                                                                                                                               | type                                                                                    | default |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- | ------- |
| pattern          | æ‰«æçš„æ–‡ä»¶è·¯å¾„è¡¨è¾¾å¼ï¼Œä¸º global è¡¨è¾¾å¼                                                                                                                    | `string` / `string[]`                                                                   |         |
| include          | include æŒ‡å®šçš„å¯¹è±¡å¦‚æœä¸åœ¨ markdown frontmatter å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ–‡ä»¶                                                                                        | `Record<string, any>`                                                                   |         |
| exclude          | exclude æŒ‡å®šçš„å¯¹è±¡å¦‚æœåœ¨ markdown frontmatter å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ–‡ä»¶ã€‚å½“ include å’Œ exclude å­˜åœ¨ç›¸åŒæ–‡ä»¶æ—¶ï¼Œexclude ä¼˜å…ˆçº§é«˜                                  | `Record<string, any>`                                                                   |         |
| transform        | è½¬æ¢å¤„ç†å¥½çš„ frontmatterï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„ frontmatter æˆ–åªè¿”å› undefinedï¼Œå¦‚æœè¿”å› {}ï¼Œåˆ™æ¸…ç©º MD æ–‡ä»¶æœ¬èº«å­˜åœ¨çš„ frontmatter                        | `(frontmatter: Record<string, any>, fileInfo: FileInfo) => Record<string, any> \| void` |         |
| globOptions      | tinyglobby çš„é…ç½®é¡¹ï¼Œæ’ä»¶é»˜è®¤å·²ç»å¿½ç•¥ node_modules å’Œ dist ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶                                                                                 | `GlobOptions`                                                                           |         |
| recoverTransform | æ¯æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œæ˜¯å¦åŸºäº transform è¿”å›çš„æ•°æ®é‡æ–°ç”Ÿæˆæ–°çš„ frontmatterï¼Œå¦‚æœä¸º falseï¼Œåˆ™åªå¯¹ä¸å­˜åœ¨çš„ key è¿›è¡Œç”Ÿæˆï¼Œå¦‚æœä¸º trueï¼Œåˆ™é‡æ–°ç”Ÿæˆæ–°çš„ frontmatter | `boolean`                                                                               | false   |

`globOptions` æ˜¯ `tinyglobby` æ’ä»¶é…ç½®é¡¹ï¼Œå¦‚æœä½ éœ€è¦å¿½ç•¥æŸäº›è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨è¯¥é…ç½®é¡¹ `globOptions.ignore`ã€‚æ›´å¤šç”¨æ³•è¯·å» tinyglobby å®˜ç½‘æŸ¥çœ‹ã€‚

## ğŸ“˜ TypeScript

### ğŸ› ï¸ Options

```typescript
import type { GlobOptions } from "tinyglobby";

export interface AutoFrontmatterOption {
  /**
   * æ‰«æçš„æ–‡ä»¶è·¯å¾„è¡¨è¾¾å¼ï¼Œä¸º global è¡¨è¾¾å¼
   */
  pattern?: string | string[];
  /**
   * include æŒ‡å®šçš„å¯¹è±¡å¦‚æœä¸åœ¨ Markdown frontmatter å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ–‡ä»¶
   */
  include?: Record<string, any>;
  /**
   * exclude æŒ‡å®šçš„å¯¹è±¡å¦‚æœåœ¨ Markdown frontmatter å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥æ–‡ä»¶ã€‚å½“ include å’Œ exclude å­˜åœ¨ç›¸åŒæ–‡ä»¶æ—¶ï¼Œexclude ä¼˜å…ˆçº§é«˜
   */
  exclude?: Record<string, any>;
  /**
   * è½¬æ¢å¤„ç†å¥½çš„ frontmatterï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ªæ–°çš„ frontmatter æˆ–åªè¿”å› undefinedï¼Œå¦‚æœè¿”å› {}ï¼Œåˆ™æ¸…ç©º MD æ–‡ä»¶æœ¬èº«å­˜åœ¨çš„ frontmatter
   */
  transform?: (frontmatter: Record<string, any>, fileInfo: FileInfo) => Record<string, any> | void;
  /**
   * tinyglobby çš„é…ç½®é¡¹
   * æ’ä»¶é»˜è®¤å·²ç»å¿½ç•¥ node_modules å’Œ dist ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶
   */
  globOptions?: GlobOptions;
  /**
   * æ¯æ¬¡å¯åŠ¨é¡¹ç›®æ—¶ï¼Œæ˜¯å¦åŸºäº transform è¿”å›çš„æ•°æ®é‡æ–°ç”Ÿæˆæ–°çš„ frontmatterï¼Œå¦‚æœä¸º falseï¼Œåˆ™åªå¯¹ä¸å­˜åœ¨çš„ key è¿›è¡Œç”Ÿæˆï¼Œå¦‚æœä¸º trueï¼Œåˆ™é‡æ–°ç”Ÿæˆæ–°çš„ frontmatter
   *
   * @default false
   */
  recoverTransform?: boolean;
}

export interface FileInfo {
  /**
   * æ–‡ä»¶ç»å¯¹è·¯å¾„
   */
  filePath: string;
  /**
   * æ–‡ä»¶ç›¸å¯¹è·¯å¾„
   */
  relativePath: string;
}
```

## License

[MIT](../../LICENSE) License Â© 2025 [Teeker](https://github.com/Kele-Bingtang)
